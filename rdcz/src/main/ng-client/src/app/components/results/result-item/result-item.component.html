<mz-card [hoverable]="true" [class]="'app-item'">
  <mz-card-content>
    <span  class="app-state">
      <span *ngFor="let stav of stavy" [class]="'app-state-item app-state-item-' + stav"></span>
    </span>
    <div class="row">
      <div class="col s2" *ngIf="hasImg">
        <img [src]="imgSrc" alt="" class="responsive-img" />
      </div><!--/.col -->
      <div [class]="hasImg ? 'col s9' : 'col s12'">
        <a *ngIf="result.title" class="card-title app-brand-text text-app-red" (click)="toggleDetail('app-card-detail-' + result.id)">
          <i *ngIf="result.druhdokumentu == 'BK'" mz-tooltip [tooltip]="'tooltip.BK' | translate" [position]="'top'" mz-icon-mdi [icon]="'book-open-page-variant'"></i>
          <i *ngIf="result.druhdokumentu == 'RP'" mz-tooltip [tooltip]="'tooltip.RP' | translate" [position]="'top'" mz-icon-mdi [icon]="'script'"></i>
          <i *ngIf="result.druhdokumentu == 'MP'" mz-tooltip [tooltip]="'tooltip.MP' | translate" [position]="'top'" accesskey=""mz-icon-mdi [icon]="'map'"></i>
          <i *ngIf="result.druhdokumentu == 'SE'" mz-tooltip [tooltip]="'tooltip.SE' | translate" [position]="'top'" mz-icon-mdi [icon]="'newspaper'"></i>
          <i *ngIf="result.druhdokumentu == 'MU'" mz-tooltip [tooltip]="'tooltip.MU' | translate" [position]="'top'" mz-icon-mdi [icon]="'music-circle'"></i>
          <i *ngIf="result.druhdokumentu == 'GP'" mz-tooltip [tooltip]="'tooltip.GP' | translate" [position]="'top'" mz-icon-mdi [icon]="'image'"></i>
          <i *ngIf="result.druhdokumentu == 'AV'" mz-tooltip [tooltip]="'tooltip.AV' | translate" [position]="'top'" mz-icon-mdi [icon]="'headphones'"></i>
          {{result.title}}
        </a>
        <label *ngIf="result.podnazev">
          <strong>{{'label.podnazev' | translate}}:</strong>
          <span>{{result.podnazev}}</span>
        </label>
        <label *ngIf="result.varnazev">
          <strong>{{'label.variantni-nazev' | translate}}:</strong>
          <span *ngFor="let v of result.varnazev">
            {{v}}<span class="app-separator">&#160;&#160;/&#160;&#160;</span>
          </span>
        </label><!--/label -->
        <label *ngIf="result.autor">
          <strong>{{'label.hlavni-autor' | translate}}:</strong>
          <span>
            {{result.autor}}<span class="app-separator">&#160;&#160;/&#160;&#160;</span>
          </span>
        </label><!--/label -->
        <label *ngIf="result.mistovyd">
          <strong>{{'label.misto-vydani' | translate}}:</strong>
          {{result.mistovyd}}
        </label><!--/label -->
        <label *ngIf="result.vydavatel">
          <strong>{{'label.nakladatel' | translate}}:</strong>
          {{result.vydavatel}}
        </label><!--/label -->
        <label *ngIf="result.rokvydstr">
          <strong>{{'label.rok-vydani' | translate}}:</strong>
          {{result.rokvydstr}}
        </label><!--/label -->
        <label *ngIf="result.vydani">
          <strong>{{'label.vydani' | translate}}:</strong>
          {{result.vydani}}
        </label><!--/label -->
        <label *ngIf="result.bibliographich_data">
          <a [href]="result.bibliographich_data" target="_blank">{{'label.bib-udaje' | translate}}</a>
        </label><!--/label -->
      </div><!--/.col -->
    </div><!--/.row -->
    
    <div class="app-card-detail" [attr.id]="'app-card-detail-' + result.id" style="display:none;">
      <table class="app-table-vlastnik">
        <thead>
          <tr>
            <th>Vlastník</th>
            <th>Počet svazků</th>
            <!--
            <th>Dig.knih. vlastníka</th>
            <th>Dig.knih. NK</th>
            <th>Podrobné bib. údaje</th>
            -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let v of vlastniky">
            <td>
              <mz-checkbox-container>
                <input mz-checkbox type="checkbox" [id]="'ch_' + result.id + '_' + v.sigla"
                       [(ngModel)]="v.active"
                       [label]="translate('cz.incad.nkp.digital.InsVlastnik', v.sigla) + ' (' + v.sigla + ')' " id="item-1" 
                       (change)="toggleVlastnik(v)">
              </mz-checkbox-container>
            </td>
            <td>{{v.count}}</td>
            <!--
            <td></td>
            <td></td>
            <td><a href="#" title="">cps19950356139</a></td>
            -->
          </tr>
        </tbody>
      </table><!--/.app-table-vlastnik -->
      
      <mz-collapsible [mode]="'expandable'">
        <mz-collapsible-item [active]="true">
          <mz-collapsible-item-header>
            <i mz-icon-mdi [icon]="'plus'"></i>
            <i mz-icon-mdi [icon]="'minus'"></i>
            {{'label.seznam-predloh' | translate}} <span class="app-brand-text text-lighten-3">({{predlohy.length}})</span>
          </mz-collapsible-item-header>
          <mz-collapsible-item-body>
            <div class="app-table-head-fixed">
              <div class="app-head-wrapper">
                <div class="app-head-sroll-hide"></div>
                <div class="app-head-sroll-wrapper">
                  <table><!-- [id]="'t_'+result.id" -->
                    <thead>
                      <tr>
                        <th (click)="sortBy('stav')">
                          <span [class.active]="currentSort === 'stav'" [class.active-down]="currentDir === 1">
                            {{'label.stav' | translate}}
                          </span>
                        </th>
                        <th><span>&#160;</span></th>
                        <th (click)="sortBy('cislordcz')">
                          <span [class.active]="currentSort === 'cislordcz'" [class.active-down]="currentDir === 1">
                            {{'label.cislo-rdcz' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('vlastnik')">
                          <span [class.active]="currentSort === 'vlastnik'" [class.active-down]="currentDir === 1">
                            {{'label.vlastnik' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('rozsah')">
                          <span [class.active]="currentSort === 'rozsah'" [class.active-down]="currentDir === 1">
                            {{'label.rok-per' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('cast')">
                          <span [class.active]="currentSort === 'cast'" [class.active-down]="currentDir === 1">
                            {{'label.cast-roc' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('cisloper')">
                          <span [class.active]="currentSort === 'cisloper'" [class.active-down]="currentDir === 1">
                            {{'label.cislo' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('financovano')">
                          <span [class.active]="currentSort === 'financovano'" [class.active-down]="currentDir === 1">
                            {{'label.financovano' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('signatura')">
                          <span [class.active]="currentSort === 'signatura'" [class.active-down]="currentDir === 1">
                            {{'label.signatura' | translate}}
                          </span>
                        </th>
                        <th (click)="sortBy('carkod')">
                          <span [class.active]="currentSort === 'carkod'" [class.active-down]="currentDir === 1">
                            {{'label.car-kod' | translate}}
                          </span>
                        </th>
                        <th>
                          <span>
                            <i class="app-mdi-pencil" mz-tooltip [tooltip]="'label.bibpoznamka' | translate" [position]="'top'"></i>
                          </span>
                        </th>
                      </tr>
                    </thead>
                  </table>
                </div>
              </div>
              <div class="app-body-wrapper">
                <table class="striped">
                  <tbody>
                    <ng-container *ngFor="let p of predlohy">
                      <tr *ngIf="p.active">
                        <td><span mz-tooltip [tooltip]="'text.'+p.stav | translate" [position]="'top'" [class]="'app-state-item app-cursor-pointer app-state-item-' + p.stav"></span></td>
                        <td>
                          <a *ngIf="p.ext_url && p.ext_url.startsWith('http')" mz-tooltip [tooltip]="'label.digitalni-dokument' | translate" [position]="'top'" [href]="p.ext_url" title="" target="_blank">
                            <i mz-icon-mdi [icon]="'open-in-new'" [size]="'16px'"></i>
                          </a>
                        </td>
                        <td>{{p.cislordcz}}</td>
                        <td mz-tooltip [position]="'top'" [tooltip]="translate('cz.incad.nkp.digital.InsVlastnik', p.vlastnik)">{{p.vlastnik}}</td>
                        <td>{{p.rozsah}}</td>
                        <td>{{p.cast}}</td>
                        <td>{{p.cisloper}}</td>
                        <td>{{translate('cz.incad.nkp.digital.Dfinancovano', p.financovano)}}</td>
                        <td>{{p.signatura}}</td>
                        <td>{{p.carkod}}</td>
                        <td>{{p.bibpoznamka}}</td>
                      </tr>
                    </ng-container>
                  </tbody>  
                </table>
              </div>
            </div><!--/.app-table-head-fixed -->
          </mz-collapsible-item-body>
        </mz-collapsible-item>

        <mz-collapsible-item *ngIf="digObjects.length > 0">
          <mz-collapsible-item-header>
            <i mz-icon-mdi [icon]="'plus'"></i>
            <i mz-icon-mdi [icon]="'minus'"></i>
            {{'label.digitalni-dokument' | translate}} <span class="app-brand-text text-lighten-3">({{digObjects.length}})</span>
          </mz-collapsible-item-header>
          <mz-collapsible-item-body>
            <mz-collection class="app-dig-object">
              <ng-container *ngFor="let dobj of digObjects">
                <a *ngIf="dobj['url'].startsWith('http')" mz-collection-link  [href]="dobj['url']" target="_blank" class="app-link">{{dobj['url']}}</a>
                <span *ngIf="!dobj['url'].startsWith('http')" class="app-dig-object-info">{{dobj['url']}}</span>
              </ng-container>
            </mz-collection>
          </mz-collapsible-item-body>
        </mz-collapsible-item>
      </mz-collapsible>
    </div><!--/.app-card-detail -->
  </mz-card-content>
  
  <mz-card-action>
    <span>
      {{'label.predlohy' | translate}}: {{predlohyCount}} 
    </span>
    <span *ngIf="result.ccnb && result.ccnb[0].startsWith('cnb')">
      <span class="app-brand-text text-lighten-3 app-pipe">|</span>
      <strong>čČNB:</strong>
      <a [href]="'http://aleph.nkp.cz/F/?func=find-c&amp;local_base=nkc01&amp;ccl_term=cnb=' + result.ccnb[0]" target="_blank" class="app-clean-mg">
        {{result.ccnb[0]}}
      </a>
    </span>
    <span *ngIf="result.isbn">
      <span class="app-brand-text text-lighten-3 app-pipe">|</span>
      <strong>ISBN:</strong>
      <a [href]="'http://aleph.nkp.cz/F/?local_base=nkc01&amp;func=find-c&amp;ccl_term=ISN=' + result.isbn" target="_blank" class="app-clean-mg">
        {{result.isbn}}
      </a>
    </span>
    <span *ngIf="result.issn">
      <span class="app-brand-text text-lighten-3 app-pipe">|</span>
      <strong>ISSN:</strong>
      <a [href]="'http://aleph.techlib.cz/F/?func=find-b&amp;find_code=SSN&amp;local_base=STK02&amp;request=' + result.issn" target="_blank" class="app-clean-mg">
        {{result.issn}}
      </a>
    </span>
    <a *ngIf="showingDetail" class="right app-clean-mg" (click)="toggleDetail('app-card-detail-' + result.id)">
       {{'btn.skryt-detail' | translate}}
    </a>
    <a *ngIf="!showingDetail" class="right app-clean-mg" (click)="toggleDetail('app-card-detail-' + result.id)">
       {{'btn.zobrazit-detail' | translate}}
    </a>
  </mz-card-action>
</mz-card>
